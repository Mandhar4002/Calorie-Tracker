<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calorie Counter</title>
    <link rel="icon" type="image/x-icon" href="/images/Logo.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="/styles/counter.css">
</head>

<body>
    <%- include("partials/nav") %>
        <div class="container">

            <div class="row justify-content-center">
                <div class="col-md-8 text-center">
                    <img src="../images/countlog.png" class=" img-responsive logo mb-5 mt-5" />
                    <form action="/counter" method="post">
                        <div class="input-group input-group-lg mb-5">
                            <input type="text" name="query" class="form-control inputstyle"
                                placeholder="Search for calories in your food..." required>
                            <button class="btn whoop" type="submit" id="button-addon2">Find calories</button>
                        </div>
                    </form>

                    <% if(locals.err) { %>
                        <div class="alert alert-danger d-flex align-items-center mt-3" role="alert">
                            <div>
                                <%= err %>
                            </div>
                        </div>
                        <% } else if (locals.item_name) { %>
                            <h1><span class="in">
                                    <%= item_name %>
                                </span> has a total of <strong>
                                    <%= calories %> Calories
                                </strong>
                                <% if (calories> 400) {%>
                                    <img src="images/shocked.png" class="img-responsive" />
                                    <% } %>
                            </h1>

                            <% } %>


                </div>
                <div class="row justify-content-center mt-5 mb-5">
                    <div class="col-md-10 caloriescont shadow rounded">
                        <div class="row">

                            <div class="col-md-6">
                                <h2 class="mt-3 mb-4">Nutritional Values </h2><span></span>
                                <ul>
                                    <li class="servingsize">Serving Size per 100/Grams <span class="float-end"></span>
                                    </li>
                                    <li>Carbohydrates: <span class="float-end">
                                            <% if(locals.carbohydrates) { %>
                                                <%= carbohydrates %> gm
                                                    <% } %>
                                        </span>
                                    </li>
                                    <li>Cholesterol: <span class="float-end">
                                            <% if(locals.cholesterol) { %>
                                                <%= cholesterol %> mg
                                                    <% } %>
                                        </span></li>
                                    <li>Saturated fat: <span class="float-end">
                                            <% if(locals.saturated_fat) { %>
                                                <%= saturated_fat %> gm
                                                    <% } %>
                                        </span></li>
                                    <li>Total Fat: <span class="float-end">
                                            <% if(locals.total_fat) { %>
                                                <%= total_fat %> gm
                                                    <% } %>
                                        </span></li>
                                    <li>Fiber Content: <span class="float-end">
                                            <% if(locals.fiber_content) { %>
                                                <%= fiber_content %> gm
                                                    <% } %>
                                        </span></li>
                                    <li>Potassium: <span class="float-end">
                                            <% if(locals.potassium) { %>
                                                <%= potassium %> mg
                                                    <% } %>
                                        </span></li>
                                    <li>Protein: <span class="float-end">
                                            <% if(locals.protein) { %>
                                                <%= protein %> gm
                                                    <% } %>
                                                        <span></li>
                                    <li>Sodium:<span class="float-end">
                                            <% if(locals.sodium) { %>
                                                <%= sodium %> mg
                                                    <% } %>
                                        </span></li>
                                    <li>Sugar: <span class="float-end">
                                            <% if(locals.sugar) { %>
                                                <%= sugar %> gm
                                                    <% } %>
                                        </span></li>
                                </ul>
                            </div>
                            <div class="col-md-6 mb-5">
                                <h4 class="mt-3 mb-4">To burn
                                    <%if (locals.calories) { %>
                                        <%= calories %>
                                            <% } %>
                                                calories you will have to
                                </h4>
                                <div class="d-flex align-items-center mb-5">
                                    <div class="flex-shrink-0">
                                        <img src="../images/running.png" alt="...">
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <h5> Jog </h5>
                                        <p>you will have to jog for
                                            <strong>
                                                <%if (locals.jog) { %>
                                                    <%= jog %>
                                                        <% } %>
                                            </strong> Minutes
                                        </p>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center mb-5">
                                    <div class="flex-shrink-0">
                                        <img src="../images/yoga.png" alt="...">
                                    </div>
                                    <div class="flex-grow-1 ms-4">
                                        <h5> Do Power Yoga </h5>
                                        <p>you will have to Power Yoga for
                                            <strong>
                                                <%if (locals.yoga) { %>
                                                    <%= yoga %>
                                                        <% } %>

                                            </strong> Minutes
                                        </p>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center mb-5">
                                    <div class="flex-shrink-0">
                                        <img src="../images/weightlifter.png" alt="...">
                                    </div>
                                    <div class="flex-grow-1 ms-4">
                                        <h5>Get a Gym Workout </h5>
                                        <p>you will have to lift weight for
                                            <strong>
                                                <%if (locals.weight) { %>
                                                    <%= weight %>
                                                        <% } %>
                                            </strong> Minutes
                                        </p>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center">
                                    <div class="flex-shrink-0">
                                        <img src="../images/walking.png" alt="...">
                                    </div>
                                    <div class="flex-grow-1 ms-1">
                                        <h5> Go for a Brisk Walk </h5>
                                        <p>you will have to brisk walk for
                                            <strong>
                                                <%if (locals.walk) { %>
                                                    <%= walk %>
                                                        <% } %>
                                            </strong> Minutes
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <canvas id="myChart" width="400" height="250"></canvas>
                            </div>

                        </div>
                    </div>
                </div>

                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

                <script>
                    const ctx = document.getElementById('myChart');
                    let c = document.querySelector(".in").textContent;
                    c = c.trimStart();

                    let arr = []

                    for (let i = 1; i < 10; i++) {
                        let num = parseFloat(document.getElementsByClassName("float-end")[i].textContent.trim().split(" ")[0])
                        arr.push(num);
                    }

                    console.log(arr);

                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Carbohydrates', 'Cholesterol', 'Saturated fat', 'Total Fat', 'Fiber Content', 'Potassium', 'Protein', 'Sodium', 'Sugar'],
                            datasets: [{
                                label: `Nutritional Values of ${c}`,
                                data: [arr[0], arr[1], arr[2], arr[3], arr[4], arr[5], arr[6], arr[7], arr[8]],
                                backgroundColor: [
                                    '#4080ff', '#fb7383', '#808080', '#40c0c0', '#ff9900', '#8000ff', '#808080', '#ffff00', '#c0c0c0' // Example colors
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            },
                            plugins: {
                                colors: {
                                    enabled: true
                                }
                            }
                        }
                    });
                </script>

                <script>
                    const curr = document.getElementById("tp");
                    curr.classList.add("active");
                    curr.removeAttribute("href");
                </script>
</body>

</html>